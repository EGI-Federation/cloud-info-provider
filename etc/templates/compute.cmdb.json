<%
    middleware = attributes['middleware']
    goc_service_type = attributes['dynamic_provider'].goc_service_type
    static_compute_info = attributes['static_compute_info']
    shares = attributes['shares']
    images = {image_id: image for vo, share in shares.items() for image_id, image in share['images'].items()}
%>\
{
    "service": {
% if middleware == "mesos":
        "gpu_support": False,
% endif
        "sitename": "${static_compute_info['site_name']}",
        "service_type": "${goc_service_type}",
        "endpoint": "${static_compute_info['compute_service_name']}"
    },
% for _vo, _share in shares.items():
    "${_vo}": {
        "images": [
% for _image_id, _image in _share['images'].items():
            {
                "image_id": "${_image['id']}",
                "image_name": "${_image['image_name']}",
                "image_description": "${_image['image_description']}",
                "image_marketplace_id": "${_image['image_marketplace_id']}",
                "architecture": "${_image['architecture']}",
                "image_os": "${_image['image_os_name']}",
                "distribution": "${_image['os_distro']}",
                "version": "${_image['image_os_version']}",
                "type": "${_image['os_distro']}",
                "gpu_driver": "NA",
                "cuda_support": "NA"
            }${'' if loop.last else ','}
% endfor
        ]
    }
% endfor
}
